name: CodeQL

on:
  push:
    branches:
      - main
    paths:
      - '**.js'
      - '**.json'
      - '!.*'
  pull_request:
    branches:
      - main
    paths:
      - '**.js'
      - '**.json'
      - '!.*'
  workflow_dispatch:

jobs:
  analyze:
    name: Analyze
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        language: ['javascript']

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v1
        with:
          languages: ${{ matrix.language }}

      - name: Autobuild
        uses: github/codeql-action/autobuild@v1

      - name: Lint Code
        shell: bash
        run: |
          yarn
          yarn prettier --check . --ignore-unknown
          yarn prettier-package-json --list-different package.json
          yarn eslint Notifier --ext .js
          yarn markdownlint '**/*.md' --ignore node_modules
          find . -name '*.json' -not -path './node_modules/*' -exec yarn jsonlint {} -q \;

      - name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v1
